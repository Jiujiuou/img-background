# 图片背景生成器交互优化开发计划

## 📋 项目背景

当前图片位置控制依赖右侧滑动条，存在以下用户体验问题：

- 滑动条控制方向与图片移动方向不直观（垂直位置用水平滑动条控制）
- 缺乏直接的视觉操作反馈
- 调整图片位置和大小需要频繁切换视线
- 操作方式不符合用户直觉

## 🎯 优化目标

1. **提升操作直觉性**：让用户能够直接操作图片，而不是间接通过控件
2. **增强视觉反馈**：提供实时的拖拽预览和状态指示
3. **保持精确控制**：在直观操作的基础上保留精确的数值控制
4. **兼容不同用户习惯**：支持多种操作方式，满足新手和专家用户

## 🚀 核心功能开发计划

### 阶段一：基础拖拽交互 (优先级：高)

#### 1.1 图片选中与编辑模式

- [ ] **功能**：点击图片进入编辑状态
- [ ] **视觉设计**：显示选中边框和控制手柄
- [ ] **交互状态**：普通预览模式 ↔ 编辑模式切换
- [ ] **技术要点**：
  - 添加图片点击事件监听
  - 实现编辑状态的视觉样式
  - 管理编辑模式的全局状态

#### 1.2 拖拽移动功能

- [ ] **功能**：直接拖拽图片调整位置
- [ ] **实时同步**：拖拽过程中同步更新右侧数值
- [ ] **边界限制**：防止图片拖拽超出合理范围
- [ ] **技术要点**：
  - 实现 `onMouseDown`、`onMouseMove`、`onMouseUp` 事件处理
  - 计算鼠标位置与图片位置的映射关系
  - 实时更新 Zustand store 中的 `_ImageStyle`

#### 1.3 可视化控制手柄

- [ ] **边界控制点**：图片四角显示调整大小的控制点
- [ ] **中心控制点**：图片中心显示移动专用的十字图标
- [ ] **边缘控制**：拖拽图片边缘同时调整大小和位置
- [ ] **比例锁定**：按住 Shift 键保持图片比例
- [ ] **技术要点**：
  - 设计控制手柄的 UI 组件
  - 实现不同控制点的拖拽逻辑
  - 处理键盘修饰键（Shift、Ctrl）

### 阶段二：快速操作与微调 (优先级：中)

#### 2.1 快速定位系统

- [ ] **九宫格布局**：提供 9 个预设位置按钮
  - 左上、中上、右上
  - 左中、居中、右中
  - 左下、中下、右下
- [ ] **一键居中**：双击图片自动居中
- [ ] **边缘对齐**：快速对齐到画布边缘的按钮
- [ ] **技术要点**：
  - 设计九宫格 UI 组件
  - 计算各个位置对应的精确数值
  - 实现双击事件检测

#### 2.2 精确微调功能

- [ ] **键盘控制**：
  - 方向键：单步移动（1px）
  - Shift + 方向键：大步移动（10px）
  - Ctrl + 方向键：微调移动（0.1px）
- [ ] **鼠标增强**：
  - 鼠标滚轮：调整图片大小
  - Ctrl + 滚轮：微调位置
- [ ] **数值输入**：支持直接输入精确的位置和大小数值
- [ ] **技术要点**：
  - 实现全局键盘事件监听
  - 处理组合键逻辑
  - 优化数值输入组件的用户体验

#### 2.3 操作历史功能

- [ ] **撤销/重做**：支持操作的撤销和重做
- [ ] **操作记录**：记录每次拖拽和调整操作
- [ ] **快捷键**：Ctrl+Z 撤销，Ctrl+Y 重做
- [ ] **技术要点**：
  - 设计操作历史的数据结构
  - 实现状态快照机制
  - 集成到现有的 Zustand store

### 阶段三：智能辅助系统 (优先级：低)

#### 3.1 视觉辅助功能

- [ ] **网格对齐**：显示可切换的辅助网格线
- [ ] **对齐线**：拖拽时显示中心线和边缘对齐提示
- [ ] **磁性吸附**：自动吸附到重要位置点
  - 画布中心
  - 黄金分割点（1/3、2/3 位置）
  - 边缘位置
- [ ] **技术要点**：
  - 实现网格线的 SVG 或 Canvas 绘制
  - 计算吸附点和吸附距离
  - 优化性能，避免拖拽卡顿

#### 3.2 智能建议系统

- [ ] **内容分析**：基于图片内容分析推荐最佳位置
- [ ] **布局建议**：根据图片比例和背景类型提供布局建议
- [ ] **自动优化**：一键应用推荐的最佳布局
- [ ] **技术要点**：
  - 研究图像分析算法（可选用第三方 API）
  - 设计推荐算法的评分机制
  - 实现建议结果的 UI 展示

## 🎨 用户体验优化

### 渐进式交互设计

- [ ] **新手引导**：首次使用时的操作提示和引导
- [ ] **功能发现**：通过 tooltip 和微动画帮助用户发现新功能
- [ ] **个性化设置**：允许用户自定义显示哪些控制方式

### 视觉反馈增强

- [ ] **拖拽预览**：拖拽过程中显示半透明的移动预览
- [ ] **状态指示**：清晰显示当前处于编辑还是预览模式
- [ ] **操作反馈**：hover 状态、点击反馈、成功提示等

### 响应式适配

- [ ] **移动端适配**：针对触摸屏优化拖拽体验
- [ ] **不同屏幕尺寸**：确保在各种屏幕尺寸下的可用性
- [ ] **无障碍访问**：支持键盘导航和屏幕阅读器

## 🛠️ 技术实现要点

### 组件架构设计

```
Preview/
├── DraggableImage/           # 新增：可拖拽图片组件
│   ├── DragHandles/         # 拖拽控制手柄
│   ├── SelectionBox/        # 选中状态边框
│   └── DragPreview/         # 拖拽预览效果
├── GridOverlay/              # 新增：网格辅助线
├── QuickPositioning/         # 新增：快速定位工具
└── 现有组件保持不变
```

### 状态管理扩展

```javascript
// Zustand store 新增状态
{
  // 现有状态保持不变
  _ImageStyle: { ... },

  // 新增交互状态
  _EditMode: false,              // 是否处于编辑模式
  _DragState: {                  // 拖拽状态
    isDragging: false,
    dragType: 'move' | 'resize', // 拖拽类型
    startPosition: { x: 0, y: 0 }
  },
  _HistoryStack: [],             // 操作历史栈
  _AssistantSettings: {          // 辅助功能设置
    showGrid: false,
    magneticSnap: true,
    snapSensitivity: 10
  }
}
```

### 事件处理优化

- [ ] **性能优化**：使用 `requestAnimationFrame` 优化拖拽性能
- [ ] **内存管理**：及时清理事件监听器，避免内存泄漏
- [ ] **错误处理**：添加边界情况处理和错误恢复机制

## 📅 开发时间规划

### 第一阶段（2-3 周）

- 周 1：图片选中与编辑模式、基础拖拽移动
- 周 2：可视化控制手柄、大小调整
- 周 3：边界限制、状态同步、基础测试

### 第二阶段（2 周）

- 周 4：快速定位系统、键盘控制
- 周 5：精确微调功能、操作历史

### 第三阶段（1-2 周）

- 周 6：智能辅助功能、视觉优化
- 周 7（可选）：高级功能、性能优化

## 🧪 测试计划

### 功能测试

- [ ] **基础拖拽**：各种拖拽场景的功能验证
- [ ] **边界处理**：极限位置和大小的处理
- [ ] **状态同步**：拖拽与控制栏数值的一致性
- [ ] **兼容性**：不同浏览器和设备的兼容性测试

### 用户体验测试

- [ ] **易用性测试**：新用户的学习成本和操作流畅度
- [ ] **性能测试**：大图片和复杂操作的性能表现
- [ ] **无障碍测试**：键盘导航和辅助技术的支持

## 📝 注意事项

1. **向后兼容**：确保现有的滑动条控制方式继续可用
2. **渐进增强**：新功能作为现有功能的增强，而不是替代
3. **用户选择**：提供设置选项，让用户选择偏好的操作方式
4. **性能优先**：确保新功能不影响现有的操作性能
5. **代码质量**：保持现有的代码风格和架构原则

## 🔄 持续优化

- **用户反馈收集**：通过使用数据和用户反馈持续优化
- **A/B 测试**：对比不同交互方案的用户体验效果
- **功能迭代**：根据实际使用情况调整功能优先级

---

_本计划将根据开发进度和用户反馈持续更新和调整_
